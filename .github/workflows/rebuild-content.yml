name: Promote Staging to Production

on:
  workflow_dispatch:
  repository_dispatch:
    types: [notion-content-promote]

jobs:
  promote:
    runs-on: ubuntu-latest
    steps:
      - name: Get staging deployment UID
        id: staging
        run: |
          uid=$(curl -sf \
            -H "Authorization: Bearer ${{ secrets.VERCEL_API_TOKEN }}" \
            "https://api.vercel.com/v13/deployments/staging-rjk-jvb-website.vercel.app" \
            | jq -r '.uid')
          echo "uid=$uid" >> $GITHUB_OUTPUT

      - name: Promote to production
        run: |
          curl -sf -X POST \
            -H "Authorization: Bearer ${{ secrets.VERCEL_API_TOKEN }}" \
            -H "Content-Type: application/json" \
            -d '{}' \
            "https://api.vercel.com/v10/deployments/${{ steps.staging.outputs.uid }}/promote"
